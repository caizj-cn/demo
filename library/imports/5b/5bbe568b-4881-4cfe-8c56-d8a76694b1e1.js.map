{"version":3,"sources":["assets\\Script\\framewrok\\SwitchScene.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qDAAgD;AAChD,oDAA+C;AAC/C,mDAA8C;AAC9C,oDAA+C;AAEzC,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAyB,CAAC;AAE1C,SAAS;AAGT;IAAyC,+BAAY;IADrD;QAAA,qEAyEC;QArEG,gBAAU,GAAmB,IAAI,CAAC;QAGlC,iBAAW,GAAa,IAAI,CAAC;QAG7B,cAAQ,GAAa,IAAI,CAAC;QAG1B,kBAAY,GAAY,IAAI,CAAC;QAGrB,cAAQ,GAAU,EAAE,CAAC;QACrB,gBAAU,GAAU,CAAC,CAAC;QACtB,oBAAc,GAAU,CAAC,CAAC;;IAuDtC,CAAC;IArDG,4BAAM,GAAN;QAEI,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACtC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACzB,qBAAW,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,GAAG,mBAAS,CAAC,KAAK,CAAC;QAChE,sBAAY,CAAC,WAAW,CAAC,mBAAS,CAAC,YAAY,EAAC,IAAI,EAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAC7E,CAAC;IAED,+BAAS,GAAT;QAEI,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,YAAY,EAAC,IAAI,EAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAChF,CAAC;IAED,mCAAa,GAAb,UAAc,GAAU,EAAC,GAAO;QAE5B,IAAG,GAAG,IAAI,IAAI;YAAC,OAAO;QACtB,IAAI,SAAS,GAAG,GAAa,CAAC;QAC9B,IAAG,SAAS,IAAI,qBAAW,CAAC,QAAQ,CAAC,QAAQ;YAAC,OAAO;QACrD,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACxB,qBAAW,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC;QAC1D,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,SAAS,EAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3F,IAAI,IAAI,CAAC,UAAU;YAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,CAAC,CAAC;IACrD,CAAC;IAED,MAAM;IACN,iCAAW,GAAX;QAEI,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE;YAEjC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QAC7B,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IAClB,CAAC;IAED,QAAQ;IACR,gCAAU,GAAV,UAAW,cAAc,EAAE,UAAU,EAAE,IAAI;QAEvC,IAAI,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;QACnF,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,cAAc,GAAG,cAAc,CAAC;QACrC,IAAI,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,UAAU,EAAE;YACvC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC;SACzC;QACD,IAAI,QAAQ,GAAG,CAAC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;QACvD,IAAI,IAAI,CAAC,UAAU;YAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACxD,IAAI,IAAI,CAAC,YAAY;YAAC,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;QACjF,IAAI,IAAI,CAAC,WAAW;YAAC,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC,EAAE,IAAI,EAAE,CAAC;IACjE,CAAC;IAED,2BAAK,GAAL;IAGA,CAAC;IApED;QADC,QAAQ,CAAC,EAAE,CAAC,WAAW,CAAC;mDACS;IAGlC;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;oDACU;IAG7B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;iDACO;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;qDACU;IAZZ,WAAW;QAD/B,OAAO;OACa,WAAW,CAwE/B;IAAD,kBAAC;CAxED,AAwEC,CAxEwC,EAAE,CAAC,SAAS,GAwEpD;kBAxEoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["import MsgCallUtils from \"./utils/MsgCallUtils\";\r\nimport GameEvent from \"../game/data/GameEvent\";\r\nimport GameManager from \"../game/gameManager\";\r\nimport GameConst from \"../game/data/GameConst\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n//场景切换过渡类\r\n\r\n@ccclass\r\nexport default class SwitchScene extends cc.Component \r\n{\r\n    @property(cc.ProgressBar)\r\n    loadingBar: cc.ProgressBar = null;\r\n\r\n    @property(cc.Label)\r\n    loadResText: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    tipsText: cc.Label = null;\r\n\r\n    @property(cc.Label)\r\n    progressText:cc.Label = null;\r\n\r\n\r\n    private curScene:string = \"\";\r\n    private totalCount:number = 0;\r\n    private completedCount:number = 0;\r\n\r\n    onLoad () \r\n    {\r\n        cc.game.addPersistRootNode(this.node);\r\n        this.node.zIndex = 100;\r\n        this.node.active = false;\r\n        GameManager.instance.curScene = this.curScene = GameConst.LOGIN;\r\n        MsgCallUtils.addObserver(GameEvent.SWITCH_SCENE,this,this.onSwitchScene);\r\n    }\r\n\r\n    onDestroy () \r\n    {\r\n        MsgCallUtils.removeObserver(GameEvent.SWITCH_SCENE,this,this.onSwitchScene);\r\n    }\r\n\r\n    onSwitchScene(msg:string,obj:any) :void \r\n    {\r\n        if(obj == null)return;\r\n        let sceneName = obj as string;\r\n        if(sceneName == GameManager.instance.curScene)return;\r\n        this.node.active = true;\r\n        GameManager.instance.curScene = this.curScene = sceneName;\r\n        cc.director.preloadScene(sceneName,this.onProgress.bind(this),this.onCompleted.bind(this));\r\n        if (this.loadingBar)this.loadingBar.progress = 0;\r\n    }\r\n\r\n    //加载完成\r\n    onCompleted () :void \r\n    {\r\n        cc.director.loadScene(this.curScene, function()\r\n        {\r\n            this.node.active = false;\r\n        }.bind(this));\r\n    }\r\n\r\n    //加载场景进度\r\n    onProgress(completedCount, totalCount, item) :void \r\n    {\r\n        let id = item.id.substring(item.id.lastIndexOf('/') + 1, item.id.lastIndexOf(\".\"));\r\n        this.totalCount = totalCount;\r\n        this.completedCount = completedCount;\r\n        if (this.completedCount > this.totalCount) {\r\n            this.completedCount = this.totalCount;\r\n        }\r\n        var progress = (this.completedCount / this.totalCount);\r\n        if (this.loadingBar)this.loadingBar.progress = progress;\r\n        if (this.progressText)this.progressText.string = Math.ceil(progress * 100) + \"%\";   \r\n        if (this.loadResText)this.loadResText.string = item.id || \"\";   \r\n    }\r\n\r\n    start () \r\n    {\r\n\r\n    }\r\n}\r\n"]}