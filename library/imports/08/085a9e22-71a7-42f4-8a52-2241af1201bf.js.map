{"version":3,"sources":["assets\\Script\\game\\effect\\effectLayer.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mEAA8D;AAC9D,+CAA0C;AAC1C,mCAA8B;AAC9B,+BAA0B;AAC1B,2CAAsC;AAEhC,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAyB,CAAC;AAG1C;IAAyC,+BAAY;IADrD;QAAA,qEAuKC;QAnKG,kBAAY,GAAa,IAAI,CAAC,CAAA,QAAQ;QAGtC,sBAAgB,GAAa,IAAI,CAAC,CAAA,QAAQ;QAG1C,iBAAW,GAAY,EAAE,CAAC;QAG1B,gBAAU,GAAa,IAAI,CAAC;QAG5B,kBAAY,GAAkB,IAAI,CAAC;QAE3B,gBAAU,GAAe,IAAI,CAAC;QAC9B,qBAAe,GAAU,EAAE,CAAC;QAE5B,cAAQ,GAAe,IAAI,CAAC;QAC5B,mBAAa,GAAU,CAAC,CAAC;QAEzB,oBAAc,GAAe,IAAI,CAAC;QAClC,yBAAmB,GAAU,EAAE,CAAC;;IA8I5C,CAAC;IA5IG,4BAAM,GAAN;QAEI,IAAI,CAAC,UAAU,GAAG,IAAI,EAAE,CAAC,QAAQ,CAAC,gBAAM,CAAC,CAAC;QAC1C,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,eAAe,EAAE,KAAK,EAAE,EACzD;YACI,IAAI,MAAM,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC/C,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;SAC/B;QAED,IAAI,CAAC,cAAc,GAAG,IAAI,EAAE,CAAC,QAAQ,CAAC,oBAAU,CAAC,CAAC;QAClD,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,mBAAmB,EAAE,KAAK,EAAE,EAC7D;YACI,IAAI,UAAU,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACvD,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;SACvC;QAED,IAAI,CAAC,QAAQ,GAAG,IAAI,EAAE,CAAC,QAAQ,CAAC,cAAI,CAAC,CAAC;QACtC,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,aAAa,EAAE,KAAK,EAAE,EACvD;YACI,IAAI,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC3C,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;SAC3B;QACD,sBAAY,CAAC,WAAW,CAAC,mBAAS,CAAC,YAAY,EAAC,IAAI,EAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC5E,sBAAY,CAAC,WAAW,CAAC,mBAAS,CAAC,gBAAgB,EAAC,IAAI,EAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QACnF,sBAAY,CAAC,WAAW,CAAC,mBAAS,CAAC,OAAO,EAAC,IAAI,EAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACnE,sBAAY,CAAC,WAAW,CAAC,mBAAS,CAAC,QAAQ,EAAC,IAAI,EAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACrE,sBAAY,CAAC,WAAW,CAAC,mBAAS,CAAC,aAAa,EAAC,IAAI,EAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACzE,sBAAY,CAAC,WAAW,CAAC,mBAAS,CAAC,SAAS,EAAC,IAAI,EAAC,IAAI,CAAC,eAAe,CAAC,CAAC;IAC5E,CAAC;IAED,sCAAgB,GAAhB,UAAiB,GAAU,EAAC,GAAU;QAElC,IAAI,SAAS,GAAG,GAAG,CAAC;QACpB,IAAI,UAAU,GAAW,IAAI,CAAC;QAC9B,SAAS,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC;QAC9C,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,GAAG,CAAC,EAClC;YACI,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;SACnD;aAED,EAAE,+CAA+C;YAC7C,UAAU,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACnD,kBAAkB;YAClB,IAAI,eAAe,GAAG,UAAU,CAAC,YAAY,CAAC,oBAAU,CAAC,CAAC;YAC1D,eAAe,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;SACpC;QACD,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;IAClC,CAAC;IAED,kCAAY,GAAZ,UAAa,GAAU,EAAC,GAAU;QAE9B,IAAI,SAAS,GAAG,GAAG,CAAC;QACpB,IAAI,MAAM,GAAW,IAAI,CAAC;QAC1B,SAAS,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC;QAC9C,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,GAAG,CAAC,EAC9B;YACI,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;SAC3C;aAED,EAAE,+CAA+C;YAC7C,MAAM,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3C,kBAAkB;YAClB,IAAI,eAAe,GAAG,MAAM,CAAC,YAAY,CAAC,gBAAM,CAAC,CAAC;YAClD,eAAe,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;SACpC;QACD,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;IAC9B,CAAC;IAED,kCAAY,GAAZ,UAAa,GAAU,EAAC,GAAU;QAE9B,IAAI,SAAS,GAAG,GAAG,CAAC;QACpB,IAAI,IAAI,GAAW,IAAI,CAAC;QACxB,SAAS,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC;QAC9C,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,EAC5B;YACI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;SACvC;aAED,EAAE,+CAA+C;YAC7C,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEvC,kBAAkB;YAClB,IAAI,aAAa,GAAG,IAAI,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC;YAC5C,aAAa,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;SAClC;QACD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;IAC5B,CAAC;IAED,qCAAe,GAAf,UAAgB,GAAU,EAAC,GAAU;QAEjC,IAAI,MAAM,GAAG,GAAc,CAAC;QAC5B,IAAI,IAAI,CAAC,UAAU,EACnB;YACI,4CAA4C;YAC5C,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;SAC/B;aAED;YACI,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YAC9B,MAAM,CAAC,OAAO,EAAE,CAAC;SACpB;IACL,CAAC;IAED,yCAAmB,GAAnB,UAAoB,GAAU,EAAC,GAAU;QAErC,IAAI,MAAM,GAAG,GAAc,CAAC;QAC5B,IAAI,IAAI,CAAC,cAAc,EACvB;YACI,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAA,GAAG;SACtC;aAED;YACI,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YAC9B,MAAM,CAAC,OAAO,EAAE,CAAC;SACpB;IACL,CAAC;IAED,mCAAa,GAAb,UAAc,GAAU,EAAC,GAAU;QAE/B,IAAI,IAAI,GAAG,GAAc,CAAC;QAC1B,IAAI,IAAI,CAAC,QAAQ,EACjB;YACI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAA,4CAA4C;SACvE;aAED;YACI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YAC5B,IAAI,CAAC,OAAO,EAAE,CAAC;SAClB;IACL,CAAC;IAED,+BAAS,GAAT;QAEI,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,YAAY,EAAC,IAAI,EAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC/E,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,SAAS,EAAC,IAAI,EAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC3E,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,OAAO,EAAC,IAAI,EAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACtE,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,QAAQ,EAAC,IAAI,EAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACxE,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,aAAa,EAAC,IAAI,EAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAC5E,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,gBAAgB,EAAC,IAAI,EAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;IAC1F,CAAC;IAlKD;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;qDACU;IAG9B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;yDACc;IAGlC;QADC,QAAQ;oDACiB;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;mDACQ;IAG5B;QADC,QAAQ,CAAC,EAAE,CAAC,WAAW,CAAC;qDACU;IAflB,WAAW;QAD/B,OAAO;OACa,WAAW,CAsK/B;IAAD,kBAAC;CAtKD,AAsKC,CAtKwC,EAAE,CAAC,SAAS,GAsKpD;kBAtKoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["import MsgCallUtils from \"../../framewrok/utils/MsgCallUtils\";\r\nimport GameEvent from \"../data/GameEvent\";\r\nimport Bullet from \"./bullet\";\r\nimport Fire from \"./fire\";\r\nimport RoleBullet from \"./roleBullet\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class EffectLayer extends cc.Component \r\n{\r\n    @property(cc.Prefab)\r\n    bulletPrefab:cc.Prefab = null;//工厂子弹类型\r\n\r\n    @property(cc.Prefab)\r\n    roleBulletPrefab:cc.Prefab = null;//玩家子弹类型\r\n\r\n    @property\r\n    roleBullets:number[] = [];\r\n\r\n    @property(cc.Prefab)\r\n    firePrefab:cc.Prefab = null;\r\n\r\n    @property(cc.SpriteAtlas)\r\n    bullet_atlas:cc.SpriteAtlas = null;\r\n\r\n    private bulletPool:cc.NodePool = null;\r\n    private bulletInitCount:number = 10;\r\n\r\n    private firePool:cc.NodePool = null;\r\n    private fireInitCount:number = 1;\r\n\r\n    private roleBulletPool:cc.NodePool = null;\r\n    private roleBulletInitCount:number = 10;\r\n\r\n    onLoad()\r\n    {\r\n        this.bulletPool = new cc.NodePool(Bullet);\r\n        for (let index = 0; index < this.bulletInitCount; index++) \r\n        {\r\n            let bullet = cc.instantiate(this.bulletPrefab);\r\n            this.bulletPool.put(bullet);\r\n        }\r\n\r\n        this.roleBulletPool = new cc.NodePool(RoleBullet);\r\n        for (let index = 0; index < this.roleBulletInitCount; index++) \r\n        {\r\n            let roleBullet = cc.instantiate(this.roleBulletPrefab);\r\n            this.roleBulletPool.put(roleBullet);\r\n        }\r\n\r\n        this.firePool = new cc.NodePool(Fire);\r\n        for (let index = 0; index < this.fireInitCount; index++) \r\n        {\r\n            let fire = cc.instantiate(this.firePrefab);\r\n            this.firePool.put(fire);\r\n        }\r\n        MsgCallUtils.addObserver(GameEvent.PLAYER_SHOOT,this,this.createRoleBullet);\r\n        MsgCallUtils.addObserver(GameEvent.PLAYER_END_SHOOT,this,this.onHeroBulletDestory);\r\n        MsgCallUtils.addObserver(GameEvent.FIRE_MC,this,this.onBulletFire);\r\n        MsgCallUtils.addObserver(GameEvent.END_FIRE,this,this.onFireDestory);\r\n        MsgCallUtils.addObserver(GameEvent.FACTORY_SHOOT,this,this.createBullet);\r\n        MsgCallUtils.addObserver(GameEvent.END_SHOOT,this,this.onBulletDestory);\r\n    }\r\n\r\n    createRoleBullet(msg:string,obj:object) \r\n    {\r\n        let shootData = obj;\r\n        let roleBullet:cc.Node = null;\r\n        shootData[\"bullet_atlas\"] = this.bullet_atlas;\r\n        if (this.roleBulletPool.size() > 0)\r\n        {\r\n            roleBullet = this.roleBulletPool.get(shootData);\r\n        } \r\n        else \r\n        { // 如果没有空闲对象，就用 cc.instantiate 重新创建,这里未调用reuse方法\r\n            roleBullet = cc.instantiate(this.roleBulletPrefab);\r\n            //可以用下面方式调用reuse方法\r\n            let bulletComponent = roleBullet.getComponent(RoleBullet);\r\n            bulletComponent.reuse(shootData);\r\n        }\r\n        roleBullet.parent = this.node;\r\n    }\r\n\r\n    createBullet(msg:string,obj:object) \r\n    {\r\n        let shootData = obj;\r\n        let bullet:cc.Node = null;\r\n        shootData[\"bullet_atlas\"] = this.bullet_atlas;\r\n        if (this.bulletPool.size() > 0)\r\n        {\r\n            bullet = this.bulletPool.get(shootData);\r\n        } \r\n        else \r\n        { // 如果没有空闲对象，就用 cc.instantiate 重新创建,这里未调用reuse方法\r\n            bullet = cc.instantiate(this.bulletPrefab);\r\n            //可以用下面方式调用reuse方法\r\n            let bulletComponent = bullet.getComponent(Bullet);\r\n            bulletComponent.reuse(shootData);\r\n        }\r\n        bullet.parent = this.node;\r\n    }\r\n\r\n    onBulletFire(msg:string,obj:object) \r\n    {\r\n        let shootData = obj;\r\n        let fire:cc.Node = null;\r\n        shootData[\"bullet_atlas\"] = this.bullet_atlas;\r\n        if (this.firePool.size() > 0)\r\n        {\r\n            fire = this.firePool.get(shootData);\r\n        } \r\n        else \r\n        { // 如果没有空闲对象，就用 cc.instantiate 重新创建,这里未调用reuse方法\r\n            fire = cc.instantiate(this.firePrefab);\r\n\r\n            //可以用下面方式调用reuse方法\r\n            let fireComponent = fire.getComponent(Fire);\r\n            fireComponent.reuse(shootData);\r\n        }\r\n        fire.parent = this.node;\r\n    }\r\n\r\n    onBulletDestory(msg:string,obj:object)\r\n    {\r\n        let bullet = obj as cc.Node;\r\n        if (this.bulletPool) \r\n        {\r\n            // 将节点放进对象池，这个方法会同时调用节点的 removeFromParent();\r\n            this.bulletPool.put(bullet);\r\n        }\r\n        else \r\n        {\r\n            bullet.removeFromParent(true);\r\n            bullet.destroy();\r\n        }\r\n    }\r\n\r\n    onHeroBulletDestory(msg:string,obj:object)\r\n    {\r\n        let bullet = obj as cc.Node;\r\n        if (this.roleBulletPool) \r\n        {\r\n            this.roleBulletPool.put(bullet);// \r\n        }\r\n        else \r\n        {\r\n            bullet.removeFromParent(true);\r\n            bullet.destroy();\r\n        }\r\n    }\r\n\r\n    onFireDestory(msg:string,obj:object)\r\n    {\r\n        let fire = obj as cc.Node;\r\n        if (this.firePool) \r\n        {\r\n            this.firePool.put(fire);// 将节点放进对象池，这个方法会同时调用节点的 removeFromParent();\r\n        }\r\n        else \r\n        {\r\n            fire.removeFromParent(true);\r\n            fire.destroy();\r\n        }\r\n    }\r\n\r\n    onDestroy()\r\n    {\r\n        MsgCallUtils.removeObserver(GameEvent.PLAYER_SHOOT,this,this.createRoleBullet);\r\n        MsgCallUtils.removeObserver(GameEvent.END_SHOOT,this,this.onBulletDestory);\r\n        MsgCallUtils.removeObserver(GameEvent.FIRE_MC,this,this.onBulletFire);\r\n        MsgCallUtils.removeObserver(GameEvent.END_FIRE,this,this.onFireDestory);\r\n        MsgCallUtils.removeObserver(GameEvent.FACTORY_SHOOT,this,this.createBullet);\r\n        MsgCallUtils.removeObserver(GameEvent.PLAYER_END_SHOOT,this,this.onHeroBulletDestory);\r\n    }\r\n}\r\n"]}