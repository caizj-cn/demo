{"version":3,"sources":["assets\\Script\\game\\effect\\roleBullet.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,6DAAwD;AACxD,mDAA8C;AAC9C,6DAAwD;AACxD,mEAA8D;AAC9D,+CAA0C;AAGpC,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAyB,CAAC;AAG1C;IAAwC,8BAAY;IADpD;QAAA,qEAoGC;QAhGG,WAAK,GAAU,IAAI,CAAC;QAGpB,WAAK,GAAU,IAAI,CAAC;QAEZ,WAAK,GAAU,EAAE,CAAC;QAClB,SAAG,GAAU,CAAC,CAAC;QACf,cAAQ,GAAU,CAAC,CAAC;QACpB,YAAM,GAAU,CAAC,CAAC;QAClB,YAAM,GAAU,CAAC,CAAC;QAElB,YAAM,GAAW,KAAK,CAAC;QAEvB,YAAM,GAAU,CAAC,CAAC;;IAmF9B,CAAC;IAjFG,0BAAK,GAAL;IAGA,CAAC;IACD,0BAAK,GAAL,UAAM,IAAI;QAEN,sBAAY,CAAC,QAAQ,CAAC,UAAU,CAAC,qBAAW,CAAC,oBAAoB,EAAC,KAAK,CAAC,CAAC;QACzE,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC;QACrB,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;QACb,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;QAC3B,IAAI,IAAI,CAAC,KAAK;YAAE,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QAC7C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QAE7B,IAAI,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC;QACzC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACjD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACjD,sDAAsD;QACtD,2FAA2F;QAC3F,2FAA2F;QAC3F,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;QACvC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;QACxC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;QAExC,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,CAAA,MAAM;QAC3D,IAAI,CAAC,IAAI,CAAC,MAAM,EAChB;YACI,IAAI,YAAY,GAAG,mBAAS,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;YACjF,IAAI,SAAS,GAAG,EAAE,CAAC,aAAa,CAAC,sBAAsB,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;YAC1E,SAAS,CAAC,IAAI,GAAG,MAAM,CAAC;YACxB,SAAS,CAAC,QAAQ,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC;YACtC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YAC7B,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACvB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;SACtB;aAED;YACI,SAAS,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;SACrC;QACD,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;QACpB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACpB,CAAC;IAED,yBAAI,GAAJ,UAAK,IAAI;QAEL,IAAI,GAAG,GAAG,EAAC,OAAO,EAAE,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC;QAC1D,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAA,MAAM;IAC9D,CAAC;IAED,wBAAG,GAAH;QAEI,IAAI,IAAI,CAAC,KAAK,IAAI,KAAK;YAAE,OAAO;QAChC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,gDAAgD;QAChD,+BAA+B;QAC/B,wDAAwD;QACxD,6DAA6D;QAC7D,sBAAY,CAAC,cAAc,CAAC,mBAAS,CAAC,gBAAgB,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACtE,CAAC;IACD,8BAAS,GAAT;IAEA,CAAC;IACD,qCAAgB,GAAhB,UAAiB,KAAK,EAAE,IAAI;QAExB,IAAI,CAAC,GAAG,EAAE,CAAC;IACf,CAAC;IACD,2BAAM,GAAN,UAAO,EAAE;QAEL,IAAI,IAAI,CAAC,KAAK,IAAI,MAAM;YAAC,OAAO;QAChC,IAAI,CAAC,GAAG,EAAE,CAAC;QACX,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QACjC,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,EAAE;YACpB,IAAI,CAAC,GAAG,EAAE,CAAC;YACX,OAAO;SACV;QACD,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;QAChC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;IAEpC,CAAC;IA9FD;QADC,QAAQ;6CACW;IAGpB;QADC,QAAQ;6CACW;IANH,UAAU;QAD9B,OAAO;OACa,UAAU,CAmG9B;IAAD,iBAAC;CAnGD,AAmGC,CAnGuC,EAAE,CAAC,SAAS,GAmGnD;kBAnGoB,UAAU","file":"","sourceRoot":"/","sourcesContent":["import SoundManager from \"../../framewrok/SoundManager\";\r\nimport SoundConfig from \"../data/SoundConfig\";\r\nimport GameUtils from \"../../framewrok/utils/GameUtils\";\r\nimport MsgCallUtils from \"../../framewrok/utils/MsgCallUtils\";\r\nimport GameEvent from \"../data/GameEvent\";\r\nimport GameManager from \"../gameManager\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class RoleBullet extends cc.Component \r\n{\r\n    @property\r\n    speed:number = 1000;\r\n\r\n    @property\r\n    range:number = 1000;\r\n\r\n    private state:string = \"\";\r\n    private idx:number = 0;\r\n    private curRange:number = 0;\r\n    private speedX:number = 0;\r\n    private speedY:number = 0;\r\n\r\n    private isInit:boolean = false;\r\n\r\n    private scaleX:number = 1;\r\n\r\n    unuse() \r\n    {\r\n        \r\n    }\r\n    reuse(data) \r\n    {\r\n        SoundManager.instance.playEffect(SoundConfig.qing_xing_qiang_jie2,false);\r\n        this.state = \"ready\";\r\n        this.idx = 0;\r\n        this.curRange = this.range;\r\n        if (data.group) this.node.group = data.group;\r\n        this.scaleX = data.scaleX;\r\n        this.node.angle = data.angle;\r\n        \r\n        let hd = this.node.angle * Math.PI / 180;\r\n        this.speedX = Math.cos(hd) * this.node.width / 2;\r\n        this.speedY = Math.sin(hd) * this.node.width / 2;\r\n        // let scaleFactor = GameManager.instance.scaleFactor;\r\n        // this.node.x = (data.v.x + this.speedX - GameManager.instance.cameraPos.x) * scaleFactor;\r\n        // this.node.y = (data.v.y + this.speedY - GameManager.instance.cameraPos.y) * scaleFactor;\r\n        this.node.x = (data.v.x + this.speedX);\r\n        this.node.y = (data.v.y + this.speedY);\r\n        this.speedX = Math.cos(hd) * this.speed;\r\n        this.speedY = Math.sin(hd) * this.speed;\r\n\r\n        let animation = this.node.getComponent(cc.Animation);//动画组件\r\n        if (!this.isInit) \r\n        {\r\n            let spriteFrames = GameUtils.getSpriteFrames(data.bullet_atlas, data.prefabName);\r\n            let readyClip = cc.AnimationClip.createWithSpriteFrames(spriteFrames, 20);\r\n            readyClip.name = 'move';\r\n            readyClip.wrapMode = cc.WrapMode.Loop;\r\n            animation.addClip(readyClip);\r\n            animation.play(\"move\");\r\n            this.isInit = true;\r\n        }\r\n        else \r\n        {\r\n            animation.playAdditive('move', 0);\r\n        }\r\n        this.state = \"move\";\r\n        this.init(data);\r\n    }\r\n\r\n    init(data)\r\n    {\r\n        let obj = {aniName: \"eff1\", v: data.v, angle: data.angle};\r\n        MsgCallUtils.notifyObserver(GameEvent.FIRE_MC, obj);//开火动画\r\n    }\r\n\r\n    end() \r\n    {\r\n        if (this.state == \"end\") return;\r\n        this.state = \"end\";\r\n        // var curPos = cc.v2(this.node.x, this.node.y);\r\n        // var angle = this.node.angle;\r\n        // let obj = {aniName: \"eff2\", v: curPos, angle: angle};\r\n        // MsgCallUtils.notifyObserver(GameEvent.FIRE_MC, obj);//开火动画\r\n        MsgCallUtils.notifyObserver(GameEvent.PLAYER_END_SHOOT,this.node);\r\n    }\r\n    onDestroy() \r\n    {\r\n    }\r\n    onCollisionEnter(other, self) \r\n    {\r\n        this.end();\r\n    }\r\n    update(dt)\r\n    {\r\n        if (this.state != \"move\")return;\r\n        this.idx++;\r\n        this.curRange -= this.speed * dt;\r\n        if (this.curRange <= 0) {\r\n            this.end();\r\n            return;\r\n        }\r\n        this.node.x += this.speedX * dt;\r\n        this.node.y += this.speedY * dt;\r\n        \r\n    }\r\n \r\n}\r\n"]}